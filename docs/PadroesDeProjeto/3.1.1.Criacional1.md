# Padr√£o de Projeto: Singleton

## Vis√£o Geral

---

## Princ√≠pios e Vantagens

A ado√ß√£o do padr√£o Singleton traz diversos benef√≠cios alinhados aos princ√≠pios de bom design de software:

- **Controle Global de Inst√¢ncias:** Garante que apenas uma √∫nica inst√¢ncia de uma classe seja criada durante toda a execu√ß√£o da aplica√ß√£o.
- **Ponto de Acesso Centralizado:** Fornece um ponto global e seguro para acessar a inst√¢ncia √∫nica.
- **Economia de Recursos:** Evita a cria√ß√£o desnecess√°ria de m√∫ltiplas inst√¢ncias de objetos que devem ser √∫nicos (ex: conex√£o com banco de dados, logger).
- **Seguran√ßa de Acesso:** Em ambientes multi-thread, implementa mecanismos de sincroniza√ß√£o para garantir que apenas uma inst√¢ncia seja criada.
- **Facilidade de Gerenciamento:** Centraliza o estado e comportamento de recursos compartilhados, tornando o c√≥digo mais previs√≠vel e mant√≠vel.

---

## Casos de Uso

√â crucial saber quando aplicar (e quando n√£o aplicar) o padr√£o.

##### ‚úÖ Quando usar Singleton?

- Quando voc√™ precisa de uma √∫nica inst√¢ncia de uma classe em toda a aplica√ß√£o (ex: gerenciador de configura√ß√£o, logger, pool de conex√µes).
- Quando m√∫ltiplas partes do c√≥digo precisam acessar o mesmo objeto sem conhecer a localiza√ß√£o exata dele.
- Quando a cria√ß√£o do objeto √© custosa e voc√™ deseja reutilizar a mesma inst√¢ncia.
- Para gerenciar recursos compartilhados que devem ter estado √∫nico e consistente.

##### üö´ Quando N√ÉO usar?

- Em testes unit√°rios, pois o Singleton cria acoplamento global que dificulta mocks e testes isolados.
- Quando voc√™ realmente precisa de m√∫ltiplas inst√¢ncias da mesma classe.

---

## Modelagem no Projeto (Diagrama UML)

O diagrama abaixo ilustra a estrutura do padr√£o Singleton em nosso projeto.

![Diagrama UML Singleton](../assets/Singleton.drawio.png)

O diagrama UML define a estrutura do padr√£o Singleton com os seguintes componentes:

- **Classe Singleton**: Mant√©m a inst√¢ncia privada e controla seu acesso.
  - `- instance: Singleton` (atributo est√°tico privado)
  - `- Singleton()` (construtor privado)
  - `+ getInstance(): Singleton` (m√©todo est√°tico p√∫blico)
  - `+ operacao()` (m√©todos de neg√≥cio p√∫blicos)

---

## Implementa√ß√£o do Padr√£o Singleton

O padr√£o Singleton pode ser implementado de diferentes formas. Apresentamos duas abordagens principais:

##### Exemplo de C√≥digo: `TypeOrmConnection` (Singleton para Conex√£o com Banco de Dados)

**Passo 1: A Classe Singleton**

Este √© o cora√ß√£o da implementa√ß√£o. A classe `TypeOrmConnection` encapsula a conex√£o com o banco de dados, garantindo que apenas uma inst√¢ncia exista. O construtor √© privado para impedir instancia√ß√£o direta, e o m√©todo `getInstance()` controla o acesso √† √∫nica inst√¢ncia da classe.

```typescript
import { DataSource } from 'typeorm';
import env from '@/main/config/env';

export interface TypeOrmConnectionOptions {
  host: string;
  port: number;
  username: string;
  password: string;
  database: string;
}

export class TypeOrmConnection {
  private static instance: TypeOrmConnection;
  private dataSource: DataSource | null = null;

  private readonly host: string;
  private readonly port: number;
  private readonly username: string;
  private readonly password: string;
  private readonly database: string;

  private constructor(options: TypeOrmConnectionOptions) {
    this.host = options.host;
    this.port = options.port;
    this.username = options.username;
    this.password = options.password;
    this.database = options.database;
  }

  public static getInstance(): TypeOrmConnection {
    if (!TypeOrmConnection.instance) {
      TypeOrmConnection.instance = new TypeOrmConnection({
        host: env.db_host,
        port: env.db_port,
        username: env.db_user,
        password: env.db_password,
        database: env.db_name,
      });
    }
    return TypeOrmConnection.instance;
  }

  public async initialize(): Promise<void> {
    if (this.dataSource && this.dataSource.isInitialized) {
      return;
    }

    this.dataSource = new DataSource({
      type: 'mysql',
      host: this.host,
      port: this.port,
      username: this.username,
      password: this.password,
      database: this.database,
      synchronize: process.env.NODE_ENV !== 'production',
      logging: process.env.NODE_ENV === 'development',
      entities: [`${__dirname}/models/*.{ts,js}`],
      migrations: [`${__dirname}/migrations/*.{ts,js}`],
    });

    await this.dataSource.initialize();
    console.log('Database connection initialized');
  }

  public getDataSource(): DataSource {
    if (!this.dataSource || !this.dataSource.isInitialized) {
      throw new Error('DataSource is not initialized');
    }
    return this.dataSource;
  }

  public async disconnect(): Promise<void> {
    if (this.dataSource && this.dataSource.isInitialized) {
      await this.dataSource.destroy();
      this.dataSource = null;
    }
  }
}
```

**Passo 2: Uso do Singleton na Inicializa√ß√£o da Aplica√ß√£o**

Aqui, na inicializa√ß√£o do servidor, chamamos `getInstance()` para obter a √∫nica inst√¢ncia. Como √© a primeira chamada, a inst√¢ncia √© criada automaticamente. Depois, inicializamos o `DataSource` para estabelecer a conex√£o com o banco MySQL. Todas as requisi√ß√µes posteriores compartilhar√£o essa mesma conex√£o.

```typescript
TypeOrmConnection.getInstance()
  .initialize()
  .then(async () => {
    const app = await setupApp();
    app.listen(env.port, () => {
      console.log(`Server is running on http://localhost:${env.port}`);
    });
  })
  .catch((error) => {
    console.error('Error during Data Source initialization:', error);
  });
```

**Passo 3: Uso do Singleton em um Reposit√≥rio**

Este exemplo mostra como qualquer reposit√≥rio da aplica√ß√£o acessa o banco de dados. Ao chamar `TypeOrmConnection.getInstance()`, ele sempre recebe a mesma inst√¢ncia criada na inicializa√ß√£o, garantindo uma √∫nica conex√£o. O reposit√≥rio n√£o precisa gerenciar conex√µes diretamente - apenas utiliza a inst√¢ncia √∫nica fornecida pelo Singleton.

```typescript
import { Repository } from 'typeorm';
import { CompetitionModel } from '../models/competition-model';
import { TypeOrmConnection } from '../typeorm-connection';
import { ICreateCompetitionRepository } from '@/application/protocols/db/create-competition-repository';
import { Competition } from '@/domain/entities/Competition';

export class CompetitionRepository implements ICreateCompetitionRepository {
  private ormRepository: Repository<CompetitionModel>;

  constructor() {
    this.ormRepository = TypeOrmConnection.getInstance().getDataSource().getRepository(CompetitionModel);
  }

  async create(data: Competition): Promise<void> {
    const competition = this.ormRepository.create(data);
    await this.ormRepository.save(competition);
  }
}
```

---

## Para Mais Detalhes

Para informa√ß√µes completas sobre a implementa√ß√£o do padr√£o Singleton, consultar o arquivo `README.md` na pasta do [monolito](https://github.com/UnBArqDsw2025-2-Turma01/2025.2-T01-G6-QueroBemEstar_Entrega_03/tree/main/monolito) do reposit√≥rio. L√° voc√™ encontrar√° documenta√ß√£o detalhada sobre a estrutura de pastas, configura√ß√µes e como executar a aplica√ß√£o.

---
## V√≠deo Apresenta√ß√£o
<iframe width="1425" height="570" src="https://www.youtube.com/embed/HF7S6Epa5Aw" title="Builder" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

### Tabela de Participa√ß√£o

| Integrante | Contribui√ß√µes Principais                                                                                                                                              |
| ---------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Artur**  | Participou da cria√ß√£o do diagrama, fez a cria√ß√£o do documento, modelou a arquitetura geral do projeto, al√©m da Configura√ß√£o inicial com TypeScript, Express e TypeORM |
| **Marcos** | Participou da cria√ß√£o do diagrama, da implementa√ß√£o do singleton TypeOrmConnection e cria√ß√£o da entidade Competition do dom√≠nio                                       |
| **Mylena** | Participou da cria√ß√£o do diagrama e Implementa√ß√£o do singleton TypeOrmConnection                                                                                      |
| **Yago**   | Participou da cria√ß√£o do diagrama e da implementa√ß√£o do singleton TypeOrmConnection                                                                                   |

## Hist√≥rico de Vers√£o

| Vers√£o | Data       | Altera√ß√£o                             | Respons√°vel       | Revisor | Data de revis√£o |
| ------ | ---------- | ------------------------------------- | ----------------- | ------- | --------------- |
| 1.0    | 23/10/2025 | Cria√ß√£o do documento sobre Singleton. | Artur Krauspenhar |         |                 |
